-*-rst-*-

This document is formatted using the ReST syntax.

Aegir 0.2 installation instructions
===================================

This document describes briefly how to install a multi-platform,
single-server Aegir Drupal provisionning system. Those instructions
limit themselves to getting you into the Aegir wizard, which will then
give you further configuration instructions.

Checking out the code
---------------------

This assumes you have installed CVS and have access to the /var
directory. This may require running those steps as root.

Shell commands::
 cd /var
 cvs -z6 -d:pserver:anonymous:anonymous@cvs.drupal.org:/cvs/drupal co -d aegir/drupal-5.x -r DRUPAL-5-12 drupal
 cd aegir/drupal-5.x/
 cvs co -d profiles/hostmaster contributions/profiles/hostmaster
 cvs co -d sites/default/modules/hosting contributions/modules/hosting
 cd /var/aegir
 cvs co -d drush  contributions/modules/drush
 mkdir .drush
 cvs co -d .drush/provision  contributions/modules/provision

Apache configuration
--------------------

Those instructions assume you are running Debian specific and
installing aegir in http://aegir.example.com. If you are running
another system you basically need to:

 1. create a directory for Aegir configs
 2. activate the mod_rewrite engine
 3. include the Aegir apache configurations in Apache
 4. create a base configuration file for Aegir in /var/aegir/config/vhost.d/aegir.example.com
 5. restart apache

Shell commands::
 cd /var/aegir
 mkdir -p config/vhost.d/
 a2enmod rewrite
 echo "Include /var/aegir/config/vhost.d/" > /etc/apache2/conf.d/aegir
 cp drupal-5.x/profiles/hostmaster/apache2.conf.txt config/vhost.d/aegir.example.com
 /etc/init.d/apache2 restart

Database configuration
----------------------

Here you want to make a basic database configuration for the Drupal
you are going to install. You want to run those commands using your
database 'root' user.

SQL commands::
 CREATE DATABASE aegir;
 GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, \
  CREATE TEMPORARY TABLES, LOCK TABLES ON aegir.* TO \
  'aegir'@'localhost' IDENTIFIED BY 'XXXXXXXX';

Install the Drupal
------------------

Now you are ready to install the first Drupal using this installation
profile. Point your browser to http://aegir.example.com/ , assuming
DNS is properly configured to point to your webserver, otherwise you
may want to try http://localhost/ .

The installer is going to complain about the permissions of
settings.php, just fix the permissions:

Shell commands::
 chmod a+w /var/aegir/drupal-5.x/sites/default/settings.php

Select the hostmaster install profile, enter the database credentials
you setup above and then the installer will prompt you to secure the
permissions on the settings.php file again:

Shell commands::
 chmod a-w /var/aegir/drupal-5.x/sites/default/settings.php

Follow the wizard
-----------------

You should now be in the installation wizard. The wizard is usually
self-documenting so you should just be able to follow the instructions
in the wizard to configure Aegir to properly use the webserver and
database server.

Installing new platforms
------------------------

To deploy new platforms to provisions site to, you simply need to
download the platform source code (which can be done with drush), use
`provision setup' to initialise the new platform and then, on the
hostmaster site, create a new Platform node which points to where the
source was downloaded.

Shell commands::
 cd /var/aegir
 ./drush/drush.php dl drupal
 cd drupal-6.10/ # varies according to latest Drupal version
 ~/drush/drush.php provision setup

Use "drush dl drupal-5.x" to get the latest release of the 5.x branch.
